<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Visualizer for YouTube</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #visualizer {
            width: 100vw;
            height: 100vh;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.1) 0%, transparent 70%);
            position: relative;
        }

        canvas {
            display: block;
            background: transparent;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-group {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        input[type="file"] {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="file"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        select {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px;
            border-radius: 5px;
            margin: 5px;
        }

        .info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: rgba(255,255,255,0.7);
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="visualizer">
        <canvas id="canvas"></canvas>
        
        <div class="controls">
            <div class="control-group">
                <input type="file" id="audioFile" accept="audio/*,.mp3,.wav,.ogg,.m4a">
                <button id="playBtn" disabled>Play</button>
                <button id="pauseBtn" disabled>Pause</button>
            </div>
            
            <div class="control-group">
                <label style="color: white;">Visualization:</label>
                <select id="visualMode">
                    <option value="bars">Classic Bars</option>
                    <option value="bars_mirror">Mirror Bars</option>
                    <option value="bars_center">Center Bars</option>
                    <option value="bars_radial">Radial Bars</option>
                    <option value="bars_wave">Wave Bars</option>
                    <option value="bars_stacked">Stacked Bars</option>
                    <option value="circle">Circular</option>
                    <option value="waveform">Waveform</option>
                    <option value="particles">Particles</option>
                    <option value="spiral">Spiral</option>
                </select>
            </div>
            
            <div class="control-group">
                <label style="color: white;">Background:</label>
                <input type="file" id="backgroundImage" accept="image/*" style="font-size: 12px; padding: 5px;">
                <button id="clearBg">Clear BG</button>
            </div>
        </div>

        <div class="info">
            <div>Upload an audio file to start visualizing</div>
            <div>Supported formats: MP3, WAV, OGG, M4A</div>
            <div>Perfect for screen recording for YouTube videos</div>
        </div>
    </div>

    <audio id="audio" style="display: none;"></audio>

    <script>
        class AudioVisualizer {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.audio = document.getElementById('audio');
                this.audioContext = null;
                this.analyser = null;
                this.dataArray = null;
                this.source = null;
                this.animationId = null;
                this.currentFileName = '';
                this.backgroundImage = null;
                
                this.particles = [];
                this.visualMode = 'bars';
                
                this.setupCanvas();
                this.setupEventListeners();
                this.setupParticles();
            }
            
            setupCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                });
            }
            
            setupEventListeners() {
                const fileInput = document.getElementById('audioFile');
                const playBtn = document.getElementById('playBtn');
                const pauseBtn = document.getElementById('pauseBtn');
                const visualMode = document.getElementById('visualMode');
                const backgroundInput = document.getElementById('backgroundImage');
                const clearBgBtn = document.getElementById('clearBg');
                
                fileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.currentFileName = file.name;
                        this.loadAudio(file);
                    }
                });
                
                playBtn.addEventListener('click', () => this.play());
                pauseBtn.addEventListener('click', () => this.pause());
                
                visualMode.addEventListener('change', (e) => {
                    this.visualMode = e.target.value;
                    if (this.visualMode === 'particles') {
                        this.setupParticles();
                    }
                });
                
                backgroundInput.addEventListener('change', (e) => this.loadBackground(e));
                clearBgBtn.addEventListener('click', () => this.clearBackground());
            }
            
            setupParticles() {
                this.particles = [];
                for (let i = 0; i < 100; i++) {
                    this.particles.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        size: Math.random() * 3 + 1,
                        hue: Math.random() * 360
                    });
                }
            }
            
            loadBackground(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const img = new Image();
                img.onload = () => {
                    this.backgroundImage = img;
                    console.log('Background image loaded');
                };
                img.onerror = () => {
                    console.error('Failed to load background image');
                    alert('Failed to load background image. Please try a different file.');
                };
                img.src = URL.createObjectURL(file);
            }
            
            clearBackground() {
                this.backgroundImage = null;
                document.getElementById('backgroundImage').value = '';
                console.log('Background cleared');
            }
            
            loadAudio(file) {
                console.log('Loading file:', file.name, 'Type:', file.type, 'Size:', file.size);
                
                const url = URL.createObjectURL(file);
                this.audio.src = url;
                
                this.audio.addEventListener('loadedmetadata', () => {
                    console.log('Audio metadata loaded successfully');
                    document.getElementById('playBtn').disabled = false;
                    document.getElementById('pauseBtn').disabled = false;
                    
                    document.querySelector('.info').innerHTML = `
                        <div style="color: #00ff88;">âœ“ Audio loaded: ${this.currentFileName}</div>
                        <div>Duration: ${Math.floor(this.audio.duration / 60)}:${Math.floor(this.audio.duration % 60).toString().padStart(2, '0')}</div>
                        <div>Click Play to start visualization</div>
                    `;
                });
                
                this.audio.addEventListener('error', (e) => {
                    console.error('Audio loading error:', e);
                    this.startDemoVisualization();
                    document.querySelector('.info').innerHTML = `
                        <div style="color: #ff6b6b;">âš  Audio format issue - showing demo</div>
                        <div>Try converting to standard MP3 format</div>
                        <div>Demo visualization running</div>
                    `;
                });
            }
            
            async play() {
                try {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        this.analyser = this.audioContext.createAnalyser();
                        this.analyser.fftSize = 512;
                        this.analyser.smoothingTimeConstant = 0.8;
                        this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);
                        
                        this.source = this.audioContext.createMediaElementSource(this.audio);
                        this.source.connect(this.analyser);
                        this.analyser.connect(this.audioContext.destination);
                    }
                    
                    if (this.audioContext.state === 'suspended') {
                        await this.audioContext.resume();
                    }
                    
                    await this.audio.play();
                    this.startVisualization();
                    
                } catch (error) {
                    console.error('Error playing audio:', error);
                    this.startDemoVisualization();
                }
            }
            
            pause() {
                this.audio.pause();
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
            }
            
            startVisualization() {
                const animate = () => {
                    if (this.audio.paused) return;
                    this.animationId = requestAnimationFrame(animate);
                    
                    if (this.analyser && this.dataArray) {
                        this.analyser.getByteFrequencyData(this.dataArray);
                        this.draw();
                    }
                };
                animate();
            }
            
            startDemoVisualization() {
                this.dataArray = new Uint8Array(256);
                
                const animate = () => {
                    this.animationId = requestAnimationFrame(animate);
                    
                    const time = Date.now() * 0.001;
                    for (let i = 0; i < this.dataArray.length; i++) {
                        this.dataArray[i] = Math.abs(Math.sin(time + i * 0.1) * 128 + Math.sin(time * 2 + i * 0.05) * 64);
                    }
                    
                    this.draw();
                };
                animate();
            }
            
            draw() {
                if (this.backgroundImage) {
                    this.ctx.globalAlpha = 0.7;
                    this.ctx.drawImage(this.backgroundImage, 0, 0, this.canvas.width, this.canvas.height);
                    this.ctx.globalAlpha = 1.0;
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                } else {
                    this.ctx.fillStyle = 'rgba(10, 10, 10, 0.2)';
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                }
                
                if (!this.dataArray || this.dataArray.every(val => val === 0)) {
                    this.drawDefaultAnimation();
                    return;
                }
                
                switch (this.visualMode) {
                    case 'bars': this.drawBars(); break;
                    case 'bars_mirror': this.drawBarsMirror(); break;
                    case 'bars_center': this.drawBarsCenter(); break;
                    case 'bars_radial': this.drawBarsRadial(); break;
                    case 'bars_wave': this.drawBarsWave(); break;
                    case 'bars_stacked': this.drawBarsStacked(); break;
                    case 'circle': this.drawCircle(); break;
                    case 'waveform': this.drawWaveform(); break;
                    case 'particles': this.drawParticles(); break;
                    case 'spiral': this.drawSpiral(); break;
                }
            }
            
            drawDefaultAnimation() {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const time = Date.now() * 0.005;
                const radius = 50 + Math.sin(time) * 20;
                
                this.ctx.strokeStyle = `hsl(${time * 50 % 360}, 70%, 60%)`;
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                this.ctx.stroke();
                
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Loading audio data...', centerX, centerY + 100);
            }
            
            drawBars() {
                const barWidth = this.canvas.width / this.dataArray.length;
                let x = 0;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const barHeight = (this.dataArray[i] / 255) * this.canvas.height * 0.8;
                    const hue = (i / this.dataArray.length) * 360;
                    const saturation = 70 + (this.dataArray[i] / 255) * 30;
                    const lightness = 50 + (this.dataArray[i] / 255) * 30;
                    
                    this.ctx.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                    this.ctx.fillRect(x, this.canvas.height - barHeight, barWidth - 2, barHeight);
                    
                    this.ctx.fillStyle = `hsla(${hue}, ${saturation}%, ${lightness}%, 0.3)`;
                    this.ctx.fillRect(x, 0, barWidth - 2, barHeight * 0.5);
                    
                    x += barWidth;
                }
            }
            
            drawBarsMirror() {
                const barWidth = this.canvas.width / this.dataArray.length;
                let x = 0;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const barHeight = (this.dataArray[i] / 255) * this.canvas.height * 0.4;
                    const centerY = this.canvas.height / 2;
                    const hue = (i / this.dataArray.length) * 360;
                    const saturation = 70 + (this.dataArray[i] / 255) * 30;
                    const lightness = 50 + (this.dataArray[i] / 255) * 30;
                    
                    this.ctx.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                    this.ctx.fillRect(x, centerY - barHeight, barWidth - 2, barHeight);
                    this.ctx.fillRect(x, centerY, barWidth - 2, barHeight);
                    
                    x += barWidth;
                }
            }
            
            drawBarsCenter() {
                const barWidth = this.canvas.width / this.dataArray.length;
                const centerX = this.canvas.width / 2;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const barHeight = (this.dataArray[i] / 255) * this.canvas.height * 0.8;
                    const hue = (i / this.dataArray.length) * 360;
                    
                    this.ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
                    
                    const leftX = centerX - (i + 1) * barWidth;
                    if (leftX >= 0) {
                        this.ctx.fillRect(leftX, this.canvas.height - barHeight, barWidth - 2, barHeight);
                    }
                    
                    const rightX = centerX + i * barWidth;
                    if (rightX < this.canvas.width) {
                        this.ctx.fillRect(rightX, this.canvas.height - barHeight, barWidth - 2, barHeight);
                    }
                }
            }
            
            drawBarsRadial() {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const baseRadius = 80;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const angle = (i / this.dataArray.length) * Math.PI * 2;
                    const barLength = (this.dataArray[i] / 255) * 200;
                    
                    const x1 = centerX + Math.cos(angle) * baseRadius;
                    const y1 = centerY + Math.sin(angle) * baseRadius;
                    const x2 = centerX + Math.cos(angle) * (baseRadius + barLength);
                    const y2 = centerY + Math.sin(angle) * (baseRadius + barLength);
                    
                    const hue = (i / this.dataArray.length) * 360;
                    const gradient = this.ctx.createLinearGradient(x1, y1, x2, y2);
                    gradient.addColorStop(0, `hsl(${hue}, 80%, 40%)`);
                    gradient.addColorStop(1, `hsl(${hue}, 80%, 80%)`);
                    
                    this.ctx.strokeStyle = gradient;
                    this.ctx.lineWidth = 4;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x1, y1);
                    this.ctx.lineTo(x2, y2);
                    this.ctx.stroke();
                }
            }
            
            drawBarsWave() {
                const barWidth = this.canvas.width / this.dataArray.length;
                let x = 0;
                const time = Date.now() * 0.002;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const baseHeight = (this.dataArray[i] / 255) * this.canvas.height * 0.6;
                    const wave = Math.sin(time + i * 0.1) * 20;
                    const barHeight = baseHeight + wave;
                    
                    const hue = (time * 50 + i * 2) % 360;
                    const saturation = 70 + (this.dataArray[i] / 255) * 30;
                    const lightness = 50 + wave;
                    
                    this.ctx.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                    this.ctx.fillRect(x, this.canvas.height - Math.abs(barHeight), barWidth - 2, Math.abs(barHeight));
                    
                    x += barWidth;
                }
            }
            
            drawBarsStacked() {
                const barWidth = this.canvas.width / this.dataArray.length;
                let x = 0;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const totalHeight = (this.dataArray[i] / 255) * this.canvas.height * 0.8;
                    const segments = 5;
                    const segmentHeight = totalHeight / segments;
                    
                    for (let j = 0; j < segments; j++) {
                        const hue = (i / this.dataArray.length) * 360 + j * 30;
                        const alpha = 1 - (j * 0.15);
                        
                        this.ctx.fillStyle = `hsla(${hue}, 80%, 60%, ${alpha})`;
                        this.ctx.fillRect(x, this.canvas.height - (j + 1) * segmentHeight, barWidth - 2, segmentHeight - 1);
                    }
                    
                    x += barWidth;
                }
            }
            
            drawCircle() {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const radius = 100;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const angle = (i / this.dataArray.length) * Math.PI * 2;
                    const amplitude = (this.dataArray[i] / 255) * 200;
                    
                    const x1 = centerX + Math.cos(angle) * radius;
                    const y1 = centerY + Math.sin(angle) * radius;
                    const x2 = centerX + Math.cos(angle) * (radius + amplitude);
                    const y2 = centerY + Math.sin(angle) * (radius + amplitude);
                    
                    const hue = (i / this.dataArray.length) * 360;
                    this.ctx.strokeStyle = `hsl(${hue}, 80%, 60%)`;
                    this.ctx.lineWidth = 3;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x1, y1);
                    this.ctx.lineTo(x2, y2);
                    this.ctx.stroke();
                }
            }
            
            drawWaveform() {
                this.ctx.strokeStyle = '#00ff88';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                
                const sliceWidth = this.canvas.width / this.dataArray.length;
                let x = 0;
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const v = this.dataArray[i] / 128;
                    const y = v * this.canvas.height / 2;
                    
                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                    
                    x += sliceWidth;
                }
                
                this.ctx.stroke();
            }
            
            drawParticles() {
                const avgFreq = this.dataArray.reduce((a, b) => a + b) / this.dataArray.length;
                
                this.particles.forEach((particle, index) => {
                    const freqData = this.dataArray[index % this.dataArray.length];
                    const intensity = freqData / 255;
                    
                    particle.x += particle.vx * (1 + intensity);
                    particle.y += particle.vy * (1 + intensity);
                    particle.size = 1 + intensity * 5;
                    
                    if (particle.x < 0 || particle.x > this.canvas.width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > this.canvas.height) particle.vy *= -1;
                    
                    this.ctx.fillStyle = `hsla(${particle.hue + avgFreq}, 80%, 60%, ${intensity})`;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }
            
            drawSpiral() {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                
                this.ctx.strokeStyle = '#ff6b6b';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                
                for (let i = 0; i < this.dataArray.length; i++) {
                    const angle = (i / this.dataArray.length) * Math.PI * 8;
                    const amplitude = (this.dataArray[i] / 255) * 3;
                    const radius = i * 2 + amplitude * 50;
                    
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                }
                
                this.ctx.stroke();
            }
        }
        
        // Initialize the visualizer
        const visualizer = new AudioVisualizer();
    </script>
</body>
</html>
